<html>
    <head>
        <title>iReceptor Data Visualization Examples.</title>
        <style>
            .error{
                color: white;
                text-align: center;
                background-color: crimson;
            }
        </style>
    </head>
    <body>
        <article class="repertoire" >
            <h1>Stats API data</h1>
            <button class="drilldownVloader" x-target="v_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-v_call_unique_drilldown-single_repertoire.json" x-gene="v">Load Rearrangement v_usage (1 repo, drilldown)</button>
            <button class="drilldownVloader" x-target="v_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-v_call_unique_drilldown.json" x-gene="v">Load Rearrangement v_usage (2 repo, drilldown)</button>
            <button class="loader" x-target="v_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-v_call_unique_drilldown.json" x-gene="v">Load Rearrangement v_usage (2 repo, no drilldown)</button>

            <div id="v_gene_usage_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show D gene sample data from 2020/11/11</div>

            <button class="drilldownDloader" x-target="d_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-d_call_unique_drilldown.json" x-gene="d">Load Rearrangement d_usage (2 repo, drilldown)</button>
            <button class="loader" x-target="d_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-d_call_unique_drilldown.json" x-gene="d">Load Rearrangement d_usage (2 repo, no drilldown)</button>

            <div id="d_gene_usage_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show D gene sample data from 2020/11/11</div>

            <button class="drilldownJloader" x-target="j_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-j_call_unique_drilldown.json" x-gene="j">Load Rearrangement j_usage (2 repo, drilldown)</button>
            <button class="loader" x-target="j_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_gene_usage_response-j_call_unique_drilldown.json" x-gene="j">Load Rearrangement j_usage (2 repo, no drilldown)</button>

            <div id="j_gene_usage_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show J gene sample data from 2020/11/11</div>
<!--
            <button class="drilldownCountloader" x-target="c_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_count_response.json" >Load Rearrangement count (2 repo, drilldown)</button>
            <button class="countloader" x-target="c_gene_usage_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_count_response.json" >Load Rearrangement count (2 repo, no drilldown)</button>

            <div id="c_gene_usage_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show C gene sample data from 2020/10/26</div>
-->
            <button class="junctionloader" x-target="junction_length_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_junction_length_response.json">Load Rearrangement junction_length (2 repo, no drilldown)</button>

            <div id="junction_length_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show Junction Length sample data from 2020/11/11</div>
 
            <button class="countloader" x-target="count_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_count_response.json">Load Rearrangement Count (2 repo, no drilldown)</button>
            <button class="countloader" x-target="count_20201111_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201111_stats_api/rearrangement_count_response-single_Repertoire.json">Load Rearrangement Count (1 repo, no drilldown)</button>

            <div id="count_20201111_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show Rearrangement Count sample data from 2020/11/11</div>

            <button class="failandsuccessloader" x-target="failandsuccess_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201202_stats_api/fail.json">Failed but now works (1 repo, drilldown)</button>
            <button class="failandsuccessloader" x-target="failandsuccess_stats_api_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20201202_stats_api/success.json">Success (1 repo, drilldown)</button>

            <div id="failandsuccess_stats_api_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show Fail and Success sample data from 2020/12/02 (Example of gene name equal to subgroup name)</div>

        </article>

        <script src="lib/jquery.min.js"></script> 
        <script src="lib/highcharts/highcharts.js"></script> 
        <script src="lib/highcharts/highcharts-3d.js"></script> 
        <script src="lib/highcharts/modules/data.js"></script> 
        <script src="lib/highcharts/modules/exporting.js"></script> 
        <script src="lib/highcharts/modules/drilldown.js"></script> 
        <script src="lib/highcharts/modules/bullet.js"></script>
        <script  src="dist/airrvisualization.js"></script>   

        <script>
            function redrawChart(gene, url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let result = window.airrvisualization.createGeneUsageStatsResult(gene).setData(data);
                    //window.airrvisualization.setDebugLevel(0);
                    
                    //Example using Properties as an instance of Properties (through Library)
                    let properties = window.airrvisualization.createProperties();
                    properties.setId(identifier).setXLabel("Category").setSort(true).setTitle("My title");
                    
                    /*
                    Change the creation of the result to within the constructor of the Chart.
                    For this I need to set :
                        properties.setDataType("VGeneUsage");
                        properties.setData(data);
                    at the properties Level.
                    Results : don't need anymore to create...Result at the Library level! Might make it easier to pass the properties file to the Result and to the Parser!

                    Problems:
                        if datetype is not set? thorws Error upon Chart creation.
                        if data is not set? Will not work...

                    */
                   // Make properties object mandatory
                   let chart = window.airrvisualization.createChart(properties).setResult(result);
                   
                   //Have logic here..
                   
                   chart.plot();
                });
            }
            function redrawDrilldownVChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let result = window.airrvisualization.createVGeneUsageStatsResult();
                    result.setDrilldown(true).setData(data);
                    //window.airrvisualization.setDebugLevel(0);

                    //Example using Properties as a String
                    let stringProperties = "{\"id\": \""+identifier+"\", \"xLabel\":\"Category\", \"yLabel\":\"Count\"}";
                    let chart = window.airrvisualization.createChart(stringProperties).setResult(result).plot();
                });
            }
            function redrawDrilldownDChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let d = window.airrvisualization.createDGeneUsageStatsResult().setDrilldown(true).setData(data);
                    //window.airrvisualization.setDebugLevel(0);

                    //Example using Properties as a JSON Object
                    let jsonProperties = {"id": identifier, "xLabel":"Category", "yLabel":"Example"};
                    let chart = window.airrvisualization.createChart(jsonProperties).setResult(d).plot();
                });
            }
            function redrawDrilldownJChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let d = window.airrvisualization.createJGeneUsageStatsResult().setDrilldown(true).setData(data);
                    //window.airrvisualization.setDebugLevel(0);

                    //Example using Properties as a instance of Properties Class
                    let prop = window.airrvisualization.createProperties().setId(identifier).setSort(true).setXLabel("Category");
                    let chart = window.airrvisualization.createChart(prop).setResult(d).plot();
                });
            }
            function redrawDrilldownCountChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let d = window.airrvisualization.createCountStatsResult().setDrilldown(true).setData(data);
                    window.airrvisualization.setDebugLevel(0);
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Gene")).setResult(d).plot();
                });
            }
            function redrawCountChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let d = window.airrvisualization.createCountStatsResult().setData(data);
                    window.airrvisualization.setDebugLevel(0);
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Gene")).setResult(d).plot();
                });
            }
            function redrawJunctionChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    let d = window.airrvisualization.createJunctionLengthStatsResult().setData(data);
                    window.airrvisualization.setDebugLevel(0);
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier)).setResult(d).plot();
                });
            }
            function redrawFailandsuccessChart(url, identifier){
                $.get(url, function(data){
                    //let d = new StatsResult(gene);
                    try {
                        let d = window.airrvisualization.createVGeneUsageStatsResult().setDrilldown(true).setData(data);
                        window.airrvisualization.setDebugLevel(70);
                        let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier)).setResult(d).plot();
                    } catch (error) {
                        $('#'+identifier).empty().addClass("error").append('<p>' + error + '</p>');
                        console.error(error);
                    }
                });
            }
            $(function () {
                $('.loader').click(function(){
                    redrawChart($(this).attr('x-gene'), $(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.drilldownVloader').click(function(){
                    redrawDrilldownVChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.drilldownDloader').click(function(){
                    redrawDrilldownDChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.drilldownJloader').click(function(){
                    redrawDrilldownJChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.drilldownCountloader').click(function(){
                    redrawDrilldownCountChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.countloader').click(function(){
                    redrawCountChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.junctionloader').click(function(){
                    redrawJunctionChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.failandsuccessloader').click(function(){
                    redrawFailandsuccessChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
            });
        </script>
    </body>
</html>