<html>
    <head>
        <title>IMMUNE DB data visualization Examples.</title>
        <script src="lib/jquery.min.js"></script> 
        <script src="lib/highcharts/highcharts.js"></script> 
        <script src="lib/highcharts/highcharts-3d.js"></script> 
        <script src="lib/highcharts/modules/data.js"></script> 
        <script src="lib/highcharts/modules/exporting.js"></script> 
        <script src="lib/highcharts/modules/drilldown.js"></script> 
        <script src="lib/highcharts/modules/heatmap.js"></script>
        <!--
        <script src="lib/highcharts/modules/boost-canvas.js"></script>
        <script src="lib/highcharts/modules/boost.js"></script>
        -->
    </head>
    <body>
        <article class="repertoire" >
            <h1>Stats API data</h1>
            <button class="loader" x-datatype="CloneCountImmuneDB" x-target="usage_20200922_top_10_clone_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20200922_stats_api/response_fraction_10.json">Load top 10 clone count</button>
            <div id="usage_20200922_top_10_clone_count_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20200922 Top 10</div>
            
            <button class="loader" x-datatype="CloneCountImmuneDB" x-target="usage_20200922_top_100_clone_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20200922_stats_api/response_fraction_100.json">Load top 100 clone count</button>            
            <div id="usage_20200922_top_100_clone_count_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20200922 Top 100</div>

            <button class="loader" x-datatype="CloneCountImmuneDB" x-target="usage_20200922_top_1000_clone_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20200922_stats_api/response_fraction_1000.json">Load top 1000 clone count</button>
            <div id="usage_20200922_top_1000_clone_count_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20200922 Top 1000</div>
        </article>

        <article class="repertoire" >
            <h1>Stats API data</h1>
            <button class="loaderTopCount" x-target="usage_20210118_top_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210118_stats_api/top_copies_working_sample.json">Load top clone count</button>
            <button class="loaderTopCountPercentage" x-target="usage_20210118_top_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210118_stats_api/top_copies_working_sample.json">Load top clone count Percentage</button>
            <div id="usage_20210118_top_count_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20210118 Top clone count</div>
       </article>

        <article class="repertoire" >
            <h1>Stats API data from 2021/01/18</h1>
            <button class="loaderFunctionalityCount" x-target="usage_20210118_functionality_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210118_stats_api/functionality.json">Load functionality count</button>
            <button class="loaderFunctionalityCountPercentage" x-target="usage_20210118_functionality_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210118_stats_api/functionality.json">Load functionality count Percentage</button>
            <div id="usage_20210118_functionality_count_data" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20210118 functionality count</div>
       </article>

        <article class="repertoire" >
            <h1>Stats API data from 2021/03/15</h1>
            <button class="loaderGeneUsageCountHeat" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered_withouth_lp15-6_airrc.json">Load Gene Usage Filtered (heatmap without lp15-6)</button>
            <button class="loaderGeneUsageCountPercentageHeat" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered_withouth_lp15-6_airrc.json">Load Gene Usage Filtered (Percentage, heatmap without lp15-6)</button><br />
            <button class="loaderGeneUsageCountHeat" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (heatmap)</button>
            <button class="loaderGeneUsageCountPercentageHeat" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (Percentage, heatmap)</button><br />
            <button class="loaderGeneUsageCount" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (3D)</button>
            <button class="loaderGeneUsageCount2D" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (2D)</button><br />
            <button class="loaderGeneUsageCountPercentage" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered(Percentage, 3D)</button>
            <button class="loaderGeneUsageCountPercentage2D" x-target="usage_20210315_count_data" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered(Percentage, 2D)</button><br />
            <div id="usage_20210315_count_data" class="iRVis" style="min-width: 310px; height: 800px; margin: 0 auto">Show sample data from 20210315 Gene Usage</div>
       </article>

        <article class="repertoire" >
            <h1>Stats API data from 2021/03/15 - VGeneUsage</h1>
            <button class="loader" x-datatype="VGeneUsage" x-target="usage_20210315_count_data_a" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered_airrc.json">Load Gene Usage Filtered (3D)</button>
            <div id="usage_20210315_count_data_a" class="iRVis" style="min-width: 310px; height: 400px; margin: 0 auto">Show sample data from 20210315 Gene Usage</div>
       </article>

        <article class="repertoire" >
            <h1>Stats API data from 2021/04/22 - CDR3 Clone Length</h1>
            <button class="loaderCloneLenght" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length (3D)</button>
            <button class="loaderCloneLenghtPercentage" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length Percentage (3D)</button><br />
            <button class="loaderCloneLenght2D" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length (2D)</button>
            <button class="loaderCloneLenghtPercentage2D" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length Percentage (2D)</button><br />
            <button class="loaderCloneLenghtSpline" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length (Spline)</button>
            <button class="loaderCloneLenghtPercentageSpline" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length Percentage (Spline)</button><br />
            <button class="loaderCloneLenghtHeat" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length (Heatmap)</button>
            <button class="loaderCloneLenghtPercentageHeat" x-datatype="VGeneUsageImmuneDB" x-target="cdr3_20210422_clone_length" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/cdr3_clone_length_airrc.json">Load CDR3 Clone Length Percentage (Heatmap)</button>
            <div id="cdr3_20210422_clone_length" class="iRVis" style="min-width: 310px; height: 800px; margin: 0 auto">Show sample data from 20210422 CDR3 Clone Length</div>
       </article>

       <article class="repertoire" >
        <h1>Vgene usage Stats API data from 2021/03/15 with metadata</h1>
        <button class="loaderGeneUsageCountHeatMetadata" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered_withouth_lp15-6_airrc.json" x-metadata="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/v_gene_usage_metadata.json">Load Gene Usage Filtered (heatmap without lp15-6)</button>
        <button class="loaderGeneUsageCountPercentageHeatMetadata" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered_withouth_lp15-6_airrc.json" x-metadata="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210422_stats_api/v_gene_usage_metadata.json">Load Gene Usage Filtered (Percentage, heatmap without lp15-6)</button><br />
        <!--
        <button class="loaderGeneUsageCountHeat" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (heatmap)</button>
        <button class="loaderGeneUsageCountPercentageHeat" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (Percentage, heatmap)</button><br />
        <button class="loaderGeneUsageCount" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (3D)</button>
        <button class="loaderGeneUsageCount2D" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered (2D)</button><br />
        <button class="loaderGeneUsageCountPercentage" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered(Percentage, 3D)</button>
        <button class="loaderGeneUsageCountPercentage2D" x-target="usage_20210315_count_data_metadata" x-data="https://raw.githubusercontent.com/marcoamarooliveira/sampledata/master/20210315_stats_api/V_gene_usage_filtered.json">Load Gene Usage Filtered(Percentage, 2D)</button><br />
        -->
        <div id="usage_20210315_count_data_metadata" class="iRVis" style="min-width: 310px; height: 800px; margin: 0 auto">Show sample data from 20210315 Gene Usage</div>
   </article>
        <script src="lib/jquery.min.js"></script> 
        <script  src="dist/airrvisualization.js"></script>   

        <script>
            function getIfNotUndefined(url){
                console.log("url:", url)
                if(url){
                    return $.get(url);
                }
                return Promise.resolve(undefined);
            }
            function redrawChart(datatype, url, identifier) {
                $.get(url, function(data){
                    window.airrvisualization.setDebugLevel(40);
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Category").setData(data).setDataType(datatype)).plot();
                });
            }
            function redrawTopCountChart(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Category").setData(data).setDataType("CloneTopCountImmuneDB")).plot();
                });
            }
            function redrawTopCountChartPercentage(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Category").setData(data).setPercentage(true).setDataType("CloneTopCountImmuneDB")).plot();
                });
            }
            function redrawFunctionalityCountChart(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Category").setData(data).setDataType("CloneFunctionalityCountImmuneDB")).plot();
                });
            }
            function redrawFunctionalityCountChartPercentage(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Category").setData(data).setPercentage(true).setDataType("CloneFunctionalityCountImmuneDB")).plot();
                });
            }
            function redrawGeneUsageCountHeat(url, identifier, metadata){
                console.log("M:", metadata);
                $.when(
                    getIfNotUndefined(url),
                    getIfNotUndefined(metadata)
                    ).then(function(data, metadata){
                        console.log("Data:", data);
                        console.log("Metadata:", metadata);
                        let props = window.airrvisualization.createProperties().setChartType("heatmap").setSort(true).setLegend(true).setPercentage(false).setDraw3D(false).setId(identifier).setXLabel("Gene").setDataType("VGeneUsageImmuneDB")
                        props.setData(data);
                        if(metadata)
                            props.setMetadata(data);
                        window.airrvisualization.createChart(props).plot();
                    }
                );
            }
            function redrawGeneUsageCountPercentageHeat(url, identifier, metadata){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setChartType("heatmap").setSort(true).setLegend(true).setPercentage(true).setDraw3D(false).setId(identifier).setXLabel("Gene").setData(data).setDataType("VGeneUsageImmuneDB")).plot();
                });
            }
            function redrawGeneUsageCount(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setXLabel("Gene").setData(data).setDataType("VGeneUsageImmuneDB")).plot();
                });
            }
            function redrawGeneUsageCount2D(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setDraw3D(false).setXLabel("Gene").setData(data).setDataType("VGeneUsageImmuneDB")).plot();
                });
            }
            function redrawGeneUsageCountPercentage(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setLegend(true).setXLabel("Gene").setData(data).setPercentage(true).setDataType("VGeneUsageImmuneDB")).plot();
                });
            }
            function redrawGeneUsageCountPercentage2D(url, identifier){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setLegend(true).setDraw3D(false).setXLabel("Gene").setData(data).setPercentage(true).setDataType("VGeneUsageImmuneDB")).plot();
                });
            }
            function redrawCloneLenght(dataTypeCode, url, identifier, chartType, draw3D, percentage){
                $.get(url, function(data){
                    let chart = window.airrvisualization.createChart(window.airrvisualization.createProperties().setId(identifier).setChartType(chartType).setLegend(true).setDraw3D(draw3D).setTitle("Clone length Percentage").setXLabel("Clone length").setData(data).setPercentage(percentage).setSort(true).setDataType(dataTypeCode)).plot();
                });
            }
            $(function () {
                $('.loaderCloneLenght').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'column', true, false);
                });
                $('.loaderCloneLenghtPercentage').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'column', true, true);
                });
                $('.loaderCloneLenght2D').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'column', false, false);
                });
                $('.loaderCloneLenghtPercentage2D').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'column', false, true);
                });
                $('.loaderCloneLenghtSpline').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'spline', false, false);
                });
                $('.loaderCloneLenghtPercentageSpline').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'spline', false, true);
                });
                $('.loaderCloneLenghtHeat').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'heatmap', false, false);
                });
                $('.loaderCloneLenghtPercentageHeat').click(function () {
                    redrawCloneLenght($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'), 'heatmap', false, true);
                });
                $('.loader').click(function () {
                    redrawChart($(this).attr('x-datatype'), $(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderTopCount').click(function(){
                    redrawTopCountChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderTopCountPercentage').click(function(){
                    redrawTopCountChartPercentage($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderFunctionalityCount').click(function(){
                    redrawFunctionalityCountChart($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderFunctionalityCountPercentage').click(function(){
                    redrawFunctionalityCountChartPercentage($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCountHeat').click(function(){
                    redrawGeneUsageCountHeat($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCountPercentageHeat').click(function(){
                    redrawGeneUsageCountPercentageHeat($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCount').click(function(){
                    redrawGeneUsageCount($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCount2D').click(function(){
                    redrawGeneUsageCount2D($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCountPercentage').click(function(){
                    redrawGeneUsageCountPercentage($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCountPercentage2D').click(function(){
                    redrawGeneUsageCountPercentage2D($(this).attr('x-data'), $(this).attr('x-target'));
                });
                $('.loaderGeneUsageCountHeatMetadata').click(function(){
                    console.log($(this).attr('x-metadata'));
                    redrawGeneUsageCountHeat($(this).attr('x-data'), $(this).attr('x-target'), $(this).attr('x-metadata'));
                });
                $('.loaderGeneUsageCountPercentageHeatMetadata').click(function(){
                    redrawGeneUsageCountPercentageHeat($(this).attr('x-data'), $(this).attr('x-target'), $(this).attr('x-metadata'));
                });
            });
        </script>
    </body>
</html>